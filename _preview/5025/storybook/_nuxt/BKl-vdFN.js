import{_ as pe}from"./fB7P6YnH.js";import{_ as me}from"./CV5aTZXU.js";import{f as ve}from"./Xs_VBmP5.js";import{f as he}from"./Dd0rXUjN.js";import{u as be}from"./BNurbrIm.js";import{u as ge,a as Se}from"./D-c0xjtQ.js";import{v as p,w as I,a as b}from"./TZ8H9kUZ.js";import{o as we}from"./CoPWYLvr.js";import{e as M,g as xe,a as _e}from"./DQnMOLSw.js";import{u as ye}from"./B_2Noz0c.js";import{u as Ce}from"./CNRdjk3K.js";import{u as ke}from"./DinEHs6j.js";import{u as Re}from"./CfZ9GF2a.js";import{u as Ie,a as Te}from"./BJ-KpVIG.js";import{C as Be,R as $e}from"./-TaKdCZx.js";import{s as Ee}from"./BOX21o1p.js";import{_ as Fe}from"./BDdERGAD.js";import{_ as Ve}from"./DpiM0ITd.js";import{_ as Ne}from"./Dly8ksgg.js";import{_ as Oe}from"./OQ7_vLSz.js";import{V as P}from"./CE9j5xii.js";import{d as Ke,I as s,C as g,w as q,K as Ae,Q as T,S as De,P as t,O as m,G as c,V as Me,T as Pe,R as qe,D as Ge,E as G,N as He,F as H,q as Le}from"./lnpB3OcH.js";const ze=["placeholder","value","aria-label","aria-expanded","aria-activedescendant"],ht=Ke({__name:"VHeaderMobile",emits:["open","close"],setup(Qe,{emit:L}){const d=s(null),S=s(null),w=s(null),B=s(null),z=g(()=>{var e;return((e=B.value)==null?void 0:e.$el)??void 0}),Q=s(null),j=Ie(),J=Te(),u=s(!1),r=s(!1),x=s(!1),U=g(()=>J.appliedFilterCount),$=g(()=>j.fetchState.isFetching),_=s({start:0,end:0}),{$sendCustomEvent:W}=be(),{updateSearchState:X,searchTerm:f,searchStatus:E}=Ce(W),o=s(f.value),F=()=>{const e=d.value;M(e),e.selectionStart=_.value.start,e.selectionEnd=_.value.end},Y=()=>{o.value&&o.value!==f.value&&(f.value=o.value),y(),V()},V=()=>{window.scrollTo({top:0,left:0,behavior:"auto"}),X()},N=()=>{r.value=!0,u.value=!0,n.value||oe()},v=()=>{r.value=!1,u.value=!1},O=()=>{const e=d.value,a=e.value.length>0?e.value.length-1:0;_.value={start:e.selectionStart??a,end:e.selectionEnd??a}},Z=()=>{o.value=d.value.value,O(),r.value&&!u.value&&N()},ee=()=>{o.value="",F()},{handleKeydown:K,handleSelect:te,handleClear:ae,recent:{isVisible:n,show:oe,hide:y,entries:ne,selectedIdx:C}}=Re({focusInput:F,term:o,isMobile:!0,isInputFocused:r});q(n,e=>{e||(v(),o.value!==f.value&&(f.value=o.value,V()))});const se=()=>r.value=!0,le=()=>{!n.value&&r.value&&v()};we(S,e=>{var l,h;((h=(l=w.value)==null?void 0:l.$el)==null?void 0:h.contains(e.target))||(r.value=!1)});const re=()=>{u.value||(O(),N())},k=e=>{y(),Le().then(()=>{const a=e==="forward"?document.getElementById(Ee):xe(document.body)[1];M(a??_e(document.body))})},ie=L,{close:A,onTriggerClick:ce,triggerA11yProps:ue}=ye({id:Be,visibleRef:x,nodeRef:S,lockBodyScroll:!0,emit:ie}),R=ge(),de=g(()=>ve(R==null?void 0:R.query.q));q(de,e=>{o.value=e??""});const{doneHydrating:fe}=ke();Se().beforeEach((e,a,l)=>{e.path!==a.path&&(A(),v()),l()});const D=(e,a)=>{var l;n.value?(e.preventDefault(),he((l=w.value)==null?void 0:l.$el,1)):a==="content-settings"&&k("forward")};return(e,a)=>{const l=pe,h=me;return H(),Ae("header",{ref_key:"headerRef",ref:S,class:"main-header z-30 flex w-full items-center px-6 py-4"},[T("form",{action:"/search",class:qe(["search-bar group flex h-12 w-full flex-row items-center overflow-hidden rounded-sm",u.value||r.value?"bg-default ring ring-pink-8":"bg-surface"]),onSubmit:b(Y,["prevent"])},[De(e.$slots,"start",{},()=>[m(c(Fe,{"is-fetching":$.value,class:"focus-visible:me-1.5px focus-visible:ms-1.5px focus-visible:!h-[45px] focus-visible:max-w-[45px]"},null,8,["is-fetching"]),[[p,!t(n)]]),m(c(P,{icon:"chevron-back",label:e.$t("header.backButton"),"rtl-flip":!0,variant:"filled-gray",onClick:t(y),onKeydown:a[0]||(a[0]=I(b(i=>k("backward"),["shift"]),["tab"]))},null,8,["label","onClick"]),[[p,t(n)]])]),T("input",{id:"search-bar",ref_key:"searchInputRef",ref:d,name:"q",placeholder:e.$t("hero.search.placeholder"),type:"search",class:"search-field ms-1 h-full w-full flex-grow appearance-none rounded-none border-tx bg-tx text-2xl text-secondary placeholder-gray-8 hover:text-default hover:placeholder-gray-12 focus-visible:outline-none",value:o.value,"aria-label":e.$t("search.searchBarLabel",{openverse:"Openverse"}),autocomplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":t(n)?"true":"false","aria-controls":"recent-searches-list","aria-haspopup":"listbox","aria-activedescendant":t(C)===void 0?void 0:`option-${t(C)}`,onInput:Z,onKeydown:a[1]||(a[1]=(...i)=>t(K)&&t(K)(...i)),onFocus:se,onFocusout:le,onClick:re},null,40,ze),m(c(P,{ref_key:"clearButtonRef",ref:Q,icon:"close-small",label:e.$t("browsePage.searchForm.clear"),onClick:ee,onKeydown:a[2]||(a[2]=I(b(i=>D(i,"clear-input"),["exact"]),["tab"]))},null,8,["label"]),[[p,t(n)&&o.value]]),m(T("span",{class:"info mx-4 hidden whitespace-nowrap text-xs group-hover:text-default group-focus:text-default md:flex"},Me(t(E)),513),[[p,!u.value&&t(E)]]),m(c(Ne,Pe({ref_key:"contentSettingsButtonRef",ref:B,"is-pressed":x.value,"applied-filter-count":U.value},t(ue),{disabled:!t(fe),onClick:t(ce),onKeydown:a[3]||(a[3]=I(b(i=>D(i,"content-settings"),["exact"]),["tab"]))}),null,16,["is-pressed","applied-filter-count","disabled","onClick"]),[[p,!t(n)]]),c(Ve,{variant:"two-thirds",visible:x.value,"is-fetching":$.value,close:t(A),"trigger-element":z.value,labelledby:"content-settings-button"},null,8,["visible","is-fetching","close","trigger-element"])],34),t(n)?(H(),Ge(h,{key:0,id:t($e),visible:!0,hide:v,"trigger-element":d.value,"trap-focus":!1,"auto-focus-on-show":!1,"auto-focus-on-hide":!1,"content-classes":"px-3","aria-label":e.$t("recentSearches.heading"),variant:"mobile-input"},{default:G(()=>[c(l,null,{default:G(()=>[c(Oe,{ref_key:"recentSearchesRef",ref:w,class:"w-[100dvw] px-3","selected-idx":t(C),entries:t(ne),bordered:!1,onSelect:t(te),onClear:t(ae),onLastTab:a[4]||(a[4]=i=>k("forward"))},null,8,["selected-idx","entries","onSelect","onClear"])]),_:1})]),_:1},8,["id","trigger-element","aria-label"])):He("",!0)],512)}}});export{ht as _};
