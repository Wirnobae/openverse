import{u as we}from"./DKepsN1e.js";import{k as T}from"./RevM6cLn.js";import{C as s,I,d as ye,a7 as se,K as c,P as b,N as P,R,L as V,M as ae,ag as G,Q as oe,V as H,T as _e,aw as xe,F as v}from"./lnpB3OcH.js";import{u as Se}from"./BsSU7JKo.js";import{r as Te,h as Me}from"./Dt-H8hG_.js";import{_ as Be}from"./DlAUqK2U.js";const Pe=({duration:a,currentTime:d,isSeekable:t,isReady:l,onSeek:i,onTogglePlayback:r})=>{const{t:n}=we({useScope:"global"}),f=s(()=>({"aria-role":"slider","aria-valuemax":a.value,"aria-valuenow":d.value,"aria-valuetext":n("waveform.currentTime",{time:d.value}),"aria-orientation":"horizontal","aria-valuemin":"0"})),o=1,k=15,_=s(()=>l.value?k/a.value:0),h=s(()=>l.value?o/a.value:0),g=s(()=>l.value?d.value/a.value:0),m=I(!1),x=u=>{const{key:z,shiftKey:O,metaKey:L}=u;if(L)i(z.includes("Left")?0:1);else{const S=z.includes("Left")?-1:1,X=(O?_.value:h.value)*S;i(g.value+X)}},w=[T.ArrowLeft,T.ArrowRight],F=[...w,T.Home,T.End],y=[...F,T.Spacebar],D=u=>t.value?y.includes(u.key):u.key===T.Spacebar;return{attributes:f,listeners:{keydown:u=>{if(D(u)){if(u.preventDefault(),m.value=F.includes(u.key),w.includes(u.key))return x(u);if(u.key===T.Home)return i(0);if(u.key===T.End)return i(1);if(u.key===T.Spacebar)return r()}},blur:()=>{m.value=!1}},meta:{modSeekDeltaFrac:_,seekDeltaFrac:h,currentFrac:g},willBeHandled:D,isSeeking:m}},Fe=(a,d)=>{const t=(r,n,f)=>r+(n-r)*f,l=[],i=(a.length-1)/(d-1);l[0]=a[0];for(let r=1;r<d-1;r++){const n=r*i,f=Math.floor(n),o=Math.ceil(n),k=n-f;l[r]=t(a[f],a[o],k)}return l[d-1]=a[a.length-1],l},De=(a,d)=>{const t=a.length,l=[];let i=0;const r=(t-2)/(d-2);let n=0,f,o,k,_;l[i++]=a[n];for(let h=0;h<d-2;h++){let g=0,m=0,x=Math.floor((h+1)*r)+1,w=Math.floor((h+2)*r)+1;w=w<t?w:t;const F=w-x;for(;x<w;x++)g+=x,m+=a[x];g/=F,m/=F;let y=Math.floor(h*r)+1;const D=Math.floor((h+1)*r)+1,A=n,W=a[n];for(o=k=-1,f=0,_=0;y<D;y++)k=Math.abs((A-g)*(a[y]-W)-(A-y)*(m-W))*.5,k>o&&(o=k,f=a[y],_=y);l[i++]=f,n=_}return l[i++]=a[t-1],l},Q=(a,d=!1)=>{const t=d?a/1e3:a,l=~~(t/3600);let i=(~~(t%3600/60)).toString();const r=(~~t%60).toString().padStart(2,"0"),n=[];return l>0&&(n.push(l),i=i.padStart(2,"0")),n.push(i,r),n.join(":")},Ae=["tabIndex","aria-disabled","aria-label"],Ie=["viewBox"],We=["width","height"],Ce=["width","height"],Le=["viewBox"],Ke=["width"],Re=["viewBox"],ze=["x","y","height"],Ee={key:1,class:"duration timestamp bg-background-var right-0"},$e={key:3,class:"loading absolute inset-0 flex items-center justify-center text-xs font-bold"},Ne=1,j=2,U=2,Ve=2,He=ye({__name:"VWaveform",props:{peaks:{},message:{},currentTime:{default:0},duration:{default:0},usableFrac:{default:1},features:{default:()=>["timestamps","seek"]},featureNotices:{default:()=>({})},audioId:{},isTabbable:{type:Boolean,default:!0},isParentSeeking:{type:Boolean,default:!1}},emits:["seeked","toggle-playback","focus","blur"],setup(a,{emit:d}){const t=a,l=d,i=e=>f.value?e.clientX-f.value.getBoundingClientRect().x:e.clientX,r=e=>i(e)/o.value.width,n=e=>Math.floor((e-U)/(j+U)),f=I(null),{dimens:o}=Se(f),k=s(()=>t.features.includes("duration")),_=s(()=>t.features.includes("timestamps")),h=s(()=>t.features.includes("seek")),g=s(()=>!t.message),m=s(()=>h.value&&g.value),x=s(()=>!t.isTabbable&&t.isParentSeeking||re.value),w=s(()=>n(o.value.width)),F=e=>{const p=Te(Me(e));return Array.from({length:100},()=>p())},y=s(()=>{var e;return(e=t.peaks)!=null&&e.length?t.peaks:F(t.audioId)}),D=s(()=>{let e=y.value;const p=e.length,M=w.value;return p<M?e=Fe(e,M):p>M&&(e=De(e,M)),e.map(B=>Math.max(B,0)*o.value.height)}),A=s(()=>[0,0,o.value.width,o.value.height].join(" ")),W=e=>e*j+e*U,J=e=>o.value.height-D.value[e],C=s(()=>{const e=K.value?S.value??0:Z.value;return o.value.width*e}),u=I(),z=s(()=>K.value?Y.value:t.currentTime),O=s(()=>{if(!u.value)return!1;const e=C.value,p=u.value.offsetWidth;return e<p+2}),L=s(()=>Number.isFinite(t.duration)&&t.duration<Ne),S=I(null),E=s(()=>{const e=S.value??Z.value;return o.value.width*e}),X=s(()=>n(E.value)),q=I(null),Y=s(()=>S.value?S.value*t.duration:t.duration),le=s(()=>{if(!q.value)return!1;const e=E.value,p=q.value.offsetWidth;return e<p+2}),{isSeeking:re,...$}=Pe({duration:se(t,"duration"),currentTime:se(t,"currentTime"),isSeekable:h,isReady:g,onSeek:e=>{te(),l("seeked",e)},onTogglePlayback:()=>l("toggle-playback")}),ne=s(()=>({...m.value?$.attributes.value:{}})),{currentFrac:Z}=$.meta,ee=e=>{S.value=r(e)},te=()=>{S.value=null},ie=e=>{l("seeked",r(e))};let N=null;const K=I(!1),ue=e=>{t.isTabbable||e.preventDefault(),K.value=!1,N=i(e),ee(e)},ce=e=>{if(N){const p=i(e);Math.abs(p-N)>Ve&&(K.value=!0)}ee(e)},ve=e=>{K.value=!1,N=null,ie(e)},fe=()=>{te()},de=e=>{e.stopPropagation(),e.preventDefault()},me=e=>{l("focus",e)},he=e=>{$.listeners.blur(),l("blur",e)},ge=s(()=>m.value?{mousedown:ue,mousemove:ce,mouseup:ve,mouseleave:fe,click:de,blur:he,focus:me,keydown:$.listeners.keydown}:{}),pe=s(()=>({"--usable-height":`${Math.floor(t.usableFrac*100)}%`,"--unusable-height":`${Math.floor((1-t.usableFrac)*100)}%`})),ke=s(()=>({"--progress-time-left":`${C.value}px`})),be=s(()=>({"--seek-time-left":`${E.value}px`}));return(e,p)=>(v(),c("div",_e(ne.value,{ref_key:"el",ref:f,class:"waveform bg-background-var group/waveform relative overflow-hidden text-default focus-visible:outline-none",style:pe.value,tabIndex:e.isTabbable&&m.value?0:-1,"aria-disabled":!m.value,"aria-label":e.$t("waveform.label")},xe(ge.value)),[m.value?(v(),c("svg",{key:0,class:"shadow-ring-1 absolute inset-0 z-20 hidden h-full w-full group-focus/waveform:block",xmlns:"http://www.w3.org/2000/svg",viewBox:A.value,preserveAspectRatio:"none"},[b(o).width&&b(o).height?(v(),c("rect",{key:0,class:"stroke-pink-8",x:"0.75",y:"0.75",width:b(o).width-1.5,height:b(o).height-1.5,rx:"2",fill:"none","stroke-width":"1.5"},null,8,We)):P("",!0),b(o).width&&b(o).height?(v(),c("rect",{key:1,class:"stroke-white",x:"2",y:"2",width:b(o).width-4,height:b(o).height-4,fill:"none","stroke-width":"1",rx:"0.75"},null,8,Ce)):P("",!0)],8,Ie)):P("",!0),(v(),c("svg",{class:"absolute inset-0 h-full w-full",xmlns:"http://www.w3.org/2000/svg",viewBox:A.value,preserveAspectRatio:"none"},[g.value?(v(),c("rect",{key:0,class:"progress-bar",x:"0",y:"0",width:C.value,height:"100%"},null,8,Ke)):P("",!0)],8,Le)),(v(),c("svg",{class:R(["bars absolute bottom-0 w-full",{"with-space":k.value||_.value}]),xmlns:"http://www.w3.org/2000/svg",viewBox:A.value,preserveAspectRatio:"none"},[(v(!0),c(V,null,ae(D.value,(M,B)=>(v(),c("rect",{key:B,class:R(["origin-bottom transform transition-transform duration-500",[g.value?"scale-y-100":"scale-y-0",B<=X.value?"fill-wave-active":"fill-wave-inactive"]]),x:W(B),y:J(B),width:j,height:M},null,10,ze))),128))],10,Re)),m.value&&x.value?(v(),c("div",{key:1,class:"absolute top-0 z-20 hidden h-full flex-col items-center justify-between bg-black group-focus/waveform:flex group-focus:flex",style:G({width:`${j}px`,left:`${C.value}px`})},[(v(),c(V,null,ae({top:["-translate-y-1/2"],bottom:["translate-y-1/2"]},(M,B)=>oe("div",{key:B,class:R(["h-2 w-2 transform rounded-full bg-black",M])}," Â  ",2)),64))],4)):P("",!0),g.value?(v(),c(V,{key:2},[_.value?(v(),c(V,{key:0},[oe("div",{ref_key:"progressTimestampEl",ref:u,class:R(["progress timestamp z-10 transform",[...O.value?["bg-background-var"]:["bg-complementary","-translate-x-full"]]]),style:G(ke.value)},H(b(Q)(z.value,L.value)),7),S.value?(v(),c("div",{key:0,ref_key:"seekTimestampEl",ref:q,class:R(["seek timestamp transform",{"-translate-x-full":!le.value}]),style:G(be.value)},H(b(Q)(Y.value,L.value)),7)):P("",!0)],64)):P("",!0),k.value?(v(),c("div",Ee,H(b(Q)(e.duration,L.value)),1)):P("",!0)],64)):(v(),c("div",$e,H(e.message),1))],16,Ae))}}),Ue=Be(He,[["__scopeId","data-v-dbe8ca01"]]);export{Ue as V,Q as t,Pe as u};
