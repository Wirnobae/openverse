import{T as M}from"./TZ8H9kUZ.js";import{P as A,L as q,a as D,R as $,u as Q,n as V}from"./D-c0xjtQ.js";import{g as w,_ as P,w as z,t as G,d as W,s as J,c as U}from"./DYcLt-QY.js";import{d as K,_ as X,at as Y,h as _,I as T,a0 as H,w as L,av as Z,q as ee,L as te,C as y,ah as ae,F as b,K as O,D as re,G as ne,P as N}from"./lnpB3OcH.js";import{u as j,b as E,c as oe}from"./BNurbrIm.js";import{u as se,a as ie,i as F,b as ue,c as le,h as ce}from"./BJ-KpVIG.js";import{u as de}from"./ewjUEeyD.js";import{u as fe}from"./CnfNh8zc.js";import{s as I}from"./BInFDkJi.js";import{s as me}from"./BOX21o1p.js";import{u as pe}from"./wqDFrKMd.js";import{A as he}from"./CRWjC3CT.js";import{_ as ve}from"./CCu0MygQ.js";import{w as ge}from"./CoPWYLvr.js";import"./CFMQYC2y.js";import"./D46q-qR7.js";import"./yH-X360_.js";import"./CVtkxrq9.js";import"./CxzAXwOf.js";import"../sb-preview/runtime.js";import"./Xs_VBmP5.js";import"./PgLs4BFy.js";import"./D0ww02ZN.js";import"./Dt-H8hG_.js";import"./BvLt3-_D.js";import"./Bz7P8nyL.js";import"./bOkDOO5J.js";import"./DToSwJe0.js";import"./BSEdKPgk.js";import"./DKepsN1e.js";import"./BsB6Edd_.js";import"./CTON8dBl.js";import"./Cpj98o6Y.js";import"./Ci7G4jyV.js";const ye=K({props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(t){const n=t.renderKey,a=t.route,c={};for(const r in t.route)Object.defineProperty(c,r,{get:()=>n===t.renderKey?t.route[r]:a[r]});return X(A,Y(c)),()=>_(t.vnode,{ref:t.vnodeRef})}}),_e=K({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(t,{attrs:n,slots:a,expose:c}){const r=j(),o=T(),l=H(A,null);let f;c({pageRef:o});const i=H(q,null);let s;const g=r.deferHydration();if(r.isHydrating){const e=r.hooks.hookOnce("app:error",g);D().beforeEach(e)}return t.pageKey&&L(()=>t.pageKey,(e,h)=>{e!==h&&r.callHook("page:loading:start")}),()=>_($,{name:t.name,route:t.route,...n},{default:e=>{const h=Re(l,e.route,e.Component),m=l&&l.matched.length===e.route.matched.length;if(!e.Component){if(s&&!m)return s;g();return}if(s&&i&&!i.isCurrent(e.route))return s;if(h&&l&&(!i||i!=null&&i.isCurrent(l)))return m?s:null;const p=w(e,t.pageKey);!r.isHydrating&&!Se(l,e.route,e.Component)&&f===p&&r.callHook("page:loading:end"),f=p;const d=!!(t.transition??e.route.meta.pageTransition??E),x=d&&ke([t.transition,e.route.meta.pageTransition,E,{onAfterLeave:()=>{r.callHook("page:transition:finish",e.Component)}}].filter(Boolean)),k=t.keepalive??e.route.meta.keepalive??oe;return s=P(M,d&&x,z(k,_(Z,{suspensible:!0,onPending:()=>r.callHook("page:start",e.Component),onResolve:()=>{ee(()=>r.callHook("page:finish",e.Component).then(()=>r.callHook("page:loading:end")).finally(g))}},{default:()=>{const R=_(ye,{key:p||void 0,vnode:a.default?_(te,void 0,a.default(e)):e.Component,route:e.route,renderKey:p||void 0,trackRootNodes:d,vnodeRef:o});return k&&(R.type.name=e.Component.type.name||e.Component.type.__name||"RouteProvider"),R}}))).default(),s}})}});function ke(t){const n=t.map(a=>({...a,onAfterLeave:a.onAfterLeave?G(a.onAfterLeave):void 0}));return W(...n)}function Re(t,n,a){if(!t)return!1;const c=n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)});return!c||c===-1?!1:n.matched.slice(0,c).some((r,o)=>{var l,f,i;return((l=r.components)==null?void 0:l.default)!==((i=(f=t.matched[o])==null?void 0:f.components)==null?void 0:i.default)})||a&&w({route:n,Component:a})!==w({route:t,Component:a})}function Se(t,n,a){return t?n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)})<n.matched.length-1:!1}const xe=["id"],be={key:1},ot=K({name:"SearchPage",__name:"search",async setup(t){let n,a;const c=j(),r=pe(),o=se(),l=ie(),f=Q(),{searchTerm:i,searchType:s,apiSearchQueryParams:g}=I(l),{fetchState:e}=I(o),h=T(`${i.value} | Openverse`);L(i,()=>{h.value=`${i.value} | Openverse`}),fe(()=>({title:h.value}));const m=T(F(s.value)?{type:s.value,items:s.value===he?o.allMedia:o.resultItems[s.value]}:null),p=async(u={})=>{if(!F(s.value)||e.value.hasStarted&&d.value!==null&&!le(d.value))return;u.shouldPersistMedia||(m.value={type:s.value,items:[]});const S=await o.fetchMedia(u);return m.value={type:s.value,items:S},d.value===null||ce(d.value)?S:d.value},d=y(()=>e.value.fetchingError),x=y(()=>e.value.isFetching);ge(g,(u,v)=>{ue(u,v)||V(l.getSearchPath())},{debounce:800,maxWait:5e3});const k=y(()=>f.query),R=y(()=>f.path),B=y(()=>r.isOn("fetch_sensitive")),C=async()=>{await p({shouldPersistMedia:!0})};return[n,a]=ae(async()=>de("search",async()=>{var v;if(c.isHydrating)return m.value;(v=document.getElementById("main-page"))==null||v.scroll(0,0);const u=await p();return!u||u&&"requestKind"in u?J(u??U("No results found")):u},{server:!1,lazy:!0,watch:[B,k,R]})),await n,a(),(u,v)=>{const S=_e;return b(),O("div",{id:N(me),tabindex:"-1",class:"browse-page flex w-full flex-col px-6 lg:px-10"},[d.value?(b(),re(ve,{key:0,"fetching-error":d.value,class:"w-full py-10"},null,8,["fetching-error"])):(b(),O("div",be,[ne(S,{"page-key":(u._.provides[A]||u.$route).path,results:m.value,"is-fetching":x.value,"search-term":N(i),"handle-load-more":C,"data-testid":"search-results"},null,8,["page-key","results","is-fetching","search-term"])]))],8,xe)}}});export{ot as default};
